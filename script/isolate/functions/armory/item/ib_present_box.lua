Include("\\settings\\static_script\\lib\\globalfunction\\gf_room_weight.lua")

tBoxes = {
	[PackItemId(2,1,31127)] = {--ä½ÐÜÃ±ºÐ×Ó
		-- {"szName", {g, d, p, n, status, bind, expire}, body },
        {"Mò Ho¸n Hïng", {0, 108, 622, 1, 5, 1, 0}, 1 },
        {"Mò Ho¸n Hïng", {0, 108, 623, 1, 5, 1, 0}, 2 },
        {"Mò Ho¸n Hïng", {0, 108, 624, 1, 5, 1, 0}, 3 },
        {"Mò Ho¸n Hïng", {0, 108, 625, 1, 5, 1, 0}, 4 },
	},
	[PackItemId(2,1,31128)] = {--×ÓÒ¹×°ºÐ×Ó
        {"Tö D¹ qu¸n", {0, 108, 825, 1, 5, 1, 0}, 1 },
        {"Tö D¹ qu¸n", {0, 108, 826, 1, 5, 1, 0}, 2 },
        {"Tö D¹ tr©m", {0, 108, 827, 1, 5, 1, 0}, 3 },
        {"Tö D¹ tr©m", {0, 108, 828, 1, 5, 1, 0}, 4 },
        {"Tö D¹ y", {0, 109, 825, 1, 5, 1, 0}, 1 },
        {"Tö D¹ y", {0, 109, 826, 1, 5, 1, 0}, 2 },
        {"Tö D¹ y", {0, 109, 827, 1, 5, 1, 0}, 3 },
        {"Tö D¹ y", {0, 109, 828, 1, 5, 1, 0}, 4 },
        {"Tö D¹ Trang", {0, 110, 825, 1, 5, 1, 0}, 1 },
        {"Tö D¹ Trang", {0, 110, 826, 1, 5, 1, 0}, 2 },
        {"Tö D¹ QuÇn", {0, 110, 827, 1, 5, 1, 0}, 3 },
        {"Tö D¹ QuÇn", {0, 110, 828, 1, 5, 1, 0}, 4 },
	},
	[PackItemId(2,1,31129)] = {--ÌìÓðôÂôÄºÐ×Ó
        {"Thiªn Vò Cµ Sa (Nãn)", {0, 108, 713, 1, 5, 1, 0}, 1 },
        {"Thiªn Vò Cµ Sa (Nãn)", {0, 108, 714, 1, 5, 1, 0}, 2 },
        {"Thiªn Vò Cµ Sa (Nãn)", {0, 108, 715, 1, 5, 1, 0}, 3 },
        {"Thiªn Vò Cµ Sa (Nãn)", {0, 108, 716, 1, 5, 1, 0}, 4 },
        {"Thiªn Vò Cµ Sa (ƒo)", {0, 109, 713, 1, 5, 1, 0}, 1 },
        {"Thiªn Vò Cµ Sa (ƒo)", {0, 109, 714, 1, 5, 1, 0}, 2 },
        {"Thiªn Vò Cµ Sa (ƒo)", {0, 109, 715, 1, 5, 1, 0}, 3 },
        {"Thiªn Vò Cµ Sa (ƒo)", {0, 109, 716, 1, 5, 1, 0}, 4 },
        {"Thiªn Vò Cµ Sa (QuÇn)", {0, 110, 713, 1, 5, 1, 0}, 1 },
        {"Thiªn Vò Cµ Sa (QuÇn)", {0, 110, 714, 1, 5, 1, 0}, 2 },
        {"Thiªn Vò Cµ Sa (QuÇn)", {0, 110, 715, 1, 5, 1, 0}, 3 },
        {"Thiªn Vò Cµ Sa (QuÇn)", {0, 110, 716, 1, 5, 1, 0}, 4 },
	},
	[PackItemId(2,1,31162)] = {--ÌìÓðôÂôÄºÐ×Ó
        {"DiÖp Th­îng Thu Phong Qu¸n", {0, 108, 953, 1, 5, 1, 0}, 1 },
        {"DiÖp Th­îng Thu Phong Qu¸n", {0, 108, 954, 1, 5, 1, 0}, 2 },
        {"DiÖp Th­îng Thu Phong Qu¸n", {0, 108, 955, 1, 5, 1, 0}, 3 },
        {"DiÖp Th­îng Thu Phong Qu¸n", {0, 108, 956, 1, 5, 1, 0}, 4 },
        {"DiÖp Th­îng Thu Phong Y", {0, 109, 953, 1, 5, 1, 0}, 1 },
        {"DiÖp Th­îng Thu Phong Y", {0, 109, 954, 1, 5, 1, 0}, 2 },
        {"DiÖp Th­îng Thu Phong Y", {0, 109, 955, 1, 5, 1, 0}, 3 },
        {"DiÖp Th­îng Thu Phong Y", {0, 109, 956, 1, 5, 1, 0}, 4 },
        {"DiÖp Th­îng Thu Phong Trang", {0, 110, 953, 1, 5, 1, 0}, 1 },
        {"DiÖp Th­îng Thu Phong Trang", {0, 110, 954, 1, 5, 1, 0}, 2 },
        {"DiÖp Th­îng Thu Phong Trang", {0, 110, 955, 1, 5, 1, 0}, 3 },
        {"DiÖp Th­îng Thu Phong Trang", {0, 110, 956, 1, 5, 1, 0}, 4 },
	},
	[PackItemId(2,1,31163)] = {--ÌìÓðôÂôÄºÐ×Ó
        {"Hång Phong KiÕm", {0, 120, 124, 1, 5, 1, 0}, 1 },
        {"Hång Phong KiÕm", {0, 120, 124, 1, 5, 1, 0}, 2 },
        {"Hång Phong KiÕm", {0, 120, 124, 1, 5, 1, 0}, 3 },
        {"Hång Phong KiÕm", {0, 120, 124, 1, 5, 1, 0}, 4 },
        {"Hång Phong-Ch©n", {0, 121, 88, 1, 5, 1, 0}, 1 },
        {"Hång Phong-Ch©n", {0, 121, 88, 1, 5, 1, 0}, 2 },
        {"Hång Phong-Ch©n", {0, 121, 88, 1, 5, 1, 0}, 3 },
        {"Hång Phong-Ch©n", {0, 121, 88, 1, 5, 1, 0}, 4 },
        {"Hång Phong-Vai", {0, 119, 100, 1, 5, 1, 0}, 1 },
        {"Hång Phong-Vai", {0, 119, 100, 1, 5, 1, 0}, 2 },
        {"Hång Phong-Vai", {0, 119, 100, 1, 5, 1, 0}, 3 },
        {"Hång Phong-Vai", {0, 119, 100, 1, 5, 1, 0}, 4 },
	},
	[PackItemId(2,1,31165)] = {--ÌìÓðôÂôÄºÐ×Ó
        {"Chim B¨ng", {0, 120, 255, 1, 5, 1, 7*24*3600}, 1 },
        {"Chim B¨ng", {0, 120, 256, 1, 5, 1, 7*24*3600}, 2 },
        {"Chim B¨ng", {0, 120, 257, 1, 5, 1, 7*24*3600}, 3 },
        {"Chim B¨ng", {0, 120, 258, 1, 5, 1, 7*24*3600}, 4 },
	},
	[PackItemId(2,1,31166)] = {--ÌìÓðôÂôÄºÐ×Ó
        {"TiÒn Long C©n", {0, 108, 837, 1, 5, 1, 0}, 1 },
        {"TiÒn Long C©n", {0, 108, 838, 1, 5, 1, 0}, 2 },
        {"TiÒn Long C©n", {0, 108, 839, 1, 5, 1, 0}, 3 },
        {"TiÒn Long C©n", {0, 108, 840, 1, 5, 1, 0}, 4 },
        {"TiÒn Long y", {0, 109, 837, 1, 5, 1, 0}, 1 },
        {"TiÒn Long y", {0, 109, 838, 1, 5, 1, 0}, 2 },
        {"TiÒn Long y", {0, 109, 839, 1, 5, 1, 0}, 3 },
        {"TiÒn Long y", {0, 109, 840, 1, 5, 1, 0}, 4 },
        {"TiÒn Long Trang", {0, 110, 837, 1, 5, 1, 0}, 1 },
        {"TiÒn Long Trang", {0, 110, 838, 1, 5, 1, 0}, 2 },
        {"TiÒn Long Trang", {0, 110, 839, 1, 5, 1, 0}, 3 },
        {"TiÒn Long Trang", {0, 110, 840, 1, 5, 1, 0}, 4 },
	},
}

function OnUse(nIndex)
	return OnUseReal(nIndex)
end

function OnUseReal(nIndex)
	local g,d,p = GetItemInfoByIndex(nIndex)
	local t = tBoxes[PackItemId(g,d,p)]
	if t then
		return give_item_by_body(nIndex, t)
	end
end

function give_item_by_body(nPackIndex, tItems)
	local nRoom = floor(getn(tItems) / 4)
	if gf_JudgeRoomWeight(nRoom, nRoom*100, 1) ~= 1 then
		return 0
	end
	if DelItemByIndex(nPackIndex, 1) ~= 1 then
		Talk(1, "", "Më Tói Ngo¹i Trang thÊt b¹i")
		return 0
	end
	local nRet = 0
	for i = 1, getn(tItems) do
		local t = tItems[i]
		local szName, tPara, nNeedBody = unpack(t)
		if GetBody() == nNeedBody then
			local g,d,p,n,s,bind,expire = unpack(tPara)
			if expire > 0 then 
				s = expire * 100 + s;
			end
			local _,nIndex = AddItem(g,d,p,n,s)
			if nIndex > 0 and bind == 1 then
				SetItemStatus(nIndex, 1, 1)
			end
			nRet = nRet + 1
		end
	end
	return nRet
end
